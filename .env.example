# ═══════════════════════════════════════════════════════════════════════════
#   Avellaneda-Stoikov V4 Strategy - Environment Configuration
# ═══════════════════════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────────────────────
# REQUIRED: Polymarket Wallet Configuration
# ─────────────────────────────────────────────────────────────────────────────
POLYMARKET_PRIVATE_KEY=your_private_key_here
POLYMARKET_FUNDER=0xYourFunderAddress
AUTH_MODE=PROXY                    # PROXY or EOA

# ─────────────────────────────────────────────────────────────────────────────
# REQUIRED: Builder/Relayer Credentials (from Polymarket)
# ─────────────────────────────────────────────────────────────────────────────
BUILDER_API_KEY=your_api_key
BUILDER_SECRET=your_secret
BUILDER_PASS_PHRASE=your_passphrase

# ─────────────────────────────────────────────────────────────────────────────
# Network Configuration
# ─────────────────────────────────────────────────────────────────────────────
POLYMARKET_HOST=https://clob.polymarket.com
POLYMARKET_CHAIN_ID=137
POLYGON_RPC_URL=https://polygon-rpc.com
RPC_URL=https://polygon-mainnet.infura.io/v3/YOUR_KEY_HERE
DATABASE_PATH=./data/trading.db

# ─────────────────────────────────────────────────────────────────────────────
# Direct Execution (bypass Builder Relayer, pay own gas from EOA MATIC)
# When enabled in PROXY mode, calls execTransaction() on the Safe directly
# instead of going through the relayer (saves 100/day quota limit)
# ─────────────────────────────────────────────────────────────────────────────
USE_DIRECT_EXECUTION=false          # true = bypass relayer, pay MATIC for gas
# PAY_OWN_GAS=false                # alias for USE_DIRECT_EXECUTION

# ─────────────────────────────────────────────────────────────────────────────
# Optional: Telegram Notifications
# ─────────────────────────────────────────────────────────────────────────────
# TELEGRAM_BOT_TOKEN=your_bot_token
# TELEGRAM_CHAT_ID=your_chat_id

# ─────────────────────────────────────────────────────────────────────────────
# Optional: Sportradar (MLB trial or production)
# ─────────────────────────────────────────────────────────────────────────────
SPORTRADAR_MLB_API_KEY=your_sportradar_api_key
SPORTRADAR_MLB_ACCESS_LEVEL=trial        # trial | production
SPORTRADAR_MLB_VERSION=v7
SPORTRADAR_MLB_LANGUAGE=en
SPORTRADAR_MLB_BASE_URL=https://api.sportradar.com

SPORTRADAR_NHL_API_KEY=your_sportradar_api_key
SPORTRADAR_NHL_ACCESS_LEVEL=trial
SPORTRADAR_NHL_VERSION=v7
SPORTRADAR_NHL_LANGUAGE=en
SPORTRADAR_NHL_BASE_URL=https://api.sportradar.com

SPORTRADAR_NFL_API_KEY=your_sportradar_api_key
SPORTRADAR_NFL_ACCESS_LEVEL=trial
SPORTRADAR_NFL_VERSION=v7
SPORTRADAR_NFL_LANGUAGE=en
SPORTRADAR_NFL_BASE_URL=https://api.sportradar.com

# ─────────────────────────────────────────────────────────────────────────────
# NHL Shock‑Fade Backtest
# ─────────────────────────────────────────────────────────────────────────────
NHL_SHOCK_DB=./data/nhl_shock.db
NHL_SHOCK_SIGMA=3
NHL_SHOCK_WINDOW=60
NHL_SHOCK_LADDER_LEVELS=3
NHL_SHOCK_LADDER_STEP=0.01
NHL_SHOCK_LADDER_WINDOW=3
NHL_SHOCK_FADE_WINDOW=15
NHL_SHOCK_TARGET_PAIR=1.02
NHL_SHOCK_TRADE_SIZE=10

# ═══════════════════════════════════════════════════════════════════════════
#   AVELLANEDA-STOIKOV CORE PARAMETERS
# ═══════════════════════════════════════════════════════════════════════════

# Core A-S Parameters
AV_GAMMA=0.25                      # Risk aversion (higher = tighter spread)
AV_KAPPA=0.50                      # Order book depth factor
AV_MIN_SPREAD=0.03                 # Minimum spread (3%)
AV_MAX_SPREAD=0.20                 # Maximum spread (20%)

# Volatility Calculation
AV_VOL_WINDOW=20                   # Price history window for volatility
AV_VOL_FLOOR=0.02                  # Minimum volatility floor
AV_VOL_MULT=3.0                    # Volatility multiplier

# Order Management
AV_REFRESH_SEC=5                   # Order refresh interval (seconds)
AV_ORDER_SIZE=10                   # Base order size (shares)
AV_TARGET_PAIR_COST=0.95           # Max pair cost for new orders
AV_TRADING_END=10                  # Stop trading X seconds before window end

# Extreme Price Filter (skip orders when prices hit these levels)
AV_EXTREME_HIGH=0.95               # Skip when price >= 95c
AV_EXTREME_LOW=0.05                # Skip when price <= 5c

# ═══════════════════════════════════════════════════════════════════════════
#   V4 ASYMMETRIC SPREAD & HEDGING
# ═══════════════════════════════════════════════════════════════════════════

# Asymmetric Spread (underweight side at BID, overweight with spread)
AV_SKEW_THRESHOLD=0.10             # Trigger asymmetric when |q| > 10%

# Hedging Controls
AV_HARD_STOP=0.25                  # Hard stop at |q| > 25% (FULL_STOP mode)
AV_RESUME=0.15                     # Resume bilateral when |q| < 15%
AV_MIN_HEDGED=60                   # Min hedged shares before hard stop activates

# Late Window Protection
AV_LATE_WINDOW=10                  # Late window starts at M10
AV_LATE_MAX_IMBAL=0.10             # Max imbalance in late window (10%)

# Continuous Order Mode
AV_CONTINUOUS_MINS=12              # Add orders every refresh for first 12 mins

# ═══════════════════════════════════════════════════════════════════════════
#   V4.3 TIME-DECAY EMERGENCY HEDGE
# ═══════════════════════════════════════════════════════════════════════════
# Max |q| decreases linearly from start to end minute
# If |q| exceeds threshold: Cancel farthest limit -> Buy MARKET on underweight

AV_EMERGENCY_START=5               # Start emergency hedge at M5
AV_EMERGENCY_END=12                # End emergency hedge window at M12
AV_EMERGENCY_MAX_Q_START=0.25      # Max |q| at M5 (25%)
AV_EMERGENCY_MIN_Q_END=0.01        # Max |q| at M12 (1%)

# Order Freeze (stop placing new orders, keep existing limits)
AV_ORDER_FREEZE=12                 # Freeze new orders after M12

# ═══════════════════════════════════════════════════════════════════════════
#   V4.4 CANCEL CHEAP LIMITS
# ═══════════════════════════════════════════════════════════════════════════
# Cancel cheap limits on losing side when winner is clear (opposite >= 90c)

AV_CANCEL_CHEAP_AT=12              # Start checking at M12
AV_CHEAP_LIMIT=0.07                # Cancel limits below 7c

# ═══════════════════════════════════════════════════════════════════════════
#   OPERATION CONTROLS
# ═══════════════════════════════════════════════════════════════════════════

# Simulation Mode (no real orders placed)
TESTBUY=false                      # Set to true for paper trading
CAPITALSIM=1000                    # Simulated capital when TESTBUY=true

# Window Limit (0 = unlimited)
AV_MAX_WINDOWS=0                   # Stop after N windows (0 = run forever)

# ═══════════════════════════════════════════════════════════════════════════
#   BUDGET MANAGEMENT (V63)
# ═══════════════════════════════════════════════════════════════════════════

# Maximum budget usage as percentage of balance (0.30 = 30%)
# When used budget exceeds this, no new SETs are placed (hedges still complete)
BUDGET_LIMIT_PCT=0.30              # Default 30%

# ═══════════════════════════════════════════════════════════════════════════
#   EMERGENCY HEDGE (V64)
# ═══════════════════════════════════════════════════════════════════════════

# Allow hedging at pair cost > $1.00 when market is volatile (many surges) and late
# Surge switch = when active side changes (UP→DOWN or DOWN→UP)
# After N switches AND M8+: max pair relaxes from $1.00 (M8) to $1.05 (M12)
EMERGENCY_HEDGE_MIN_SWITCHES=3     # Activate after N surge switches (default 3)
